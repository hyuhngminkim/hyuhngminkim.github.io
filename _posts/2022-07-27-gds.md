---
title: 'NVIDIA GPUDirect Storage'
date: 2022-07-27
permalink: /posts/2022/07/gds/
tags:
  - GPU
---

![](/images/gds/gds.png)
출처: *[https://developer.nvidia.com/blog/gpudirect-storage/](https://developer.nvidia.com/blog/gpudirect-storage/)*

GPU는 우리 생활에서 정말 많이 사용됩니다. 
원래의 목적인 그래픽 연산에서부터 인공지능 학습까지, 과거에 비해서 훨씬 다양한 분야에서 사용되고 있는데요. 
데이터베이스 분야에서 GPU는, 적어도 제가 아는 한에서는 일종의 애증의 관계였습니다. 
먼저 GPU를 사용하는 데 있어서 생기는 문제점을 살펴보도록 하겠습니다. 

## GPU는 왜 느린가

분명 GPU의 강력한 병렬 연산 기능은 데이터베이스를 가속화하는 데에 도움이 될 수 있지만, 이 과정에 큰 문제가 하나 있습니다. 
바로 GPU가 호스트 시스템에 종속적이라는 것입니다. 
이게 무슨 뜻이냐면, 예를 들어서 GPU 연산을 하려고 할 때 그 데이터를 우선 호스트 메모리에 로드한 뒤, 그 데이터를 PCI-Express(PCIe)를 통해서 GPU 메모리로 옮겨온 뒤에야 GPU 연산을 할 수 있다는 것입니다. 
이 과정에서 CPU 연산 자원과 호스트 메모리의 공간이 소모되는 등 불필요한 과정이 너무 많이 끼어듭니다. 
뿐만 아니라 GPU를 연결하는 PCIe가 상당한 병목현상을 유발하는데, 초당 데이터 전송률이 GPU의 연산 속도에 훨씬 미치지 못해 너무 비효율적인 것입니다. 

전체적인 과정은 위 그림의 좌측 도식에서 확인하실 수 있습니다. 
우선, CPU 연산을 통해 우측의 NVMe 저장소에서 데이터를 시스템 메모리, 즉 호스트 메모리로 로드합니다. 
이 과정에서 시스템 메모리에 할당되는 버퍼를 바운스 버퍼(bounce buffer)라고 부르며, 두 장치 사이의 데이터 전송을 위해 일시적으로 할당되는 버퍼를 의미합니다. 
그 다음, CPU 연산을 통해 시스템 메모리에 있는 데이터를 GPU 메모리로 전송합니다. 
이렇게 GPU 메모리에 데이터가 로드 된 뒤에야 연산을 수행할 수 있게 되는 것입니다. 

정리하자면 GPU를 사용하는 데에는 다음과 같은 문제가 있습니다. 
1. 데이터를 옮기는 과정을 지시하는 CPU 연산
2. 전송되는 데이터를 저장하는 바운스 버퍼로 인한 시스템 메모리 공간 소모 
3. 전체적으로 데이터를 전송하는 데 쓰이는 PCIe 버스의 전송 속도의 한계

GPU 자체는 굉장히 빠른데, 이런 시스템적인 한계 때문에 사용이 꺼려졌던 것입니다. 
(그럼에도 불구하고 GPU를 효율적으로 사용하려는 노력은 계속되어 왔습니다. )

## NVIDIA GPUDirect Storage

이런 문제를 해결할 수 있을까 고민을 했었는데, 조사를 잠깐 하면서 찾아낸 것이 [NVIDIA GPUDirect Storage](https://docs.nvidia.com/gpudirect-storage/index.html)입니다. 
NVIDIA에서 제작하는 GPUDirect 시리즈의 일환이라고 하는데, 이것에 대해서 공부한 것을 조금 정리하고자 합니다. 

### GPUDirect

